<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xr.exchange.dao.AdminDao">
    <resultMap id="baseResultMap" type="com.xr.exchange.model.AdminBean">
        <id column="id" property="id" jdbcType="INTEGER"/>
        <id column="username" property="username" jdbcType="VARCHAR"/>
        <id column="password" property="password" jdbcType="VARCHAR"/>
        <id column="realname" property="realname" jdbcType="VARCHAR"/>
        <id column="phone" property="phone" jdbcType="VARCHAR"/>
        <id column="level" property="level" jdbcType="INTEGER"/>
        <id column="money" property="money" jdbcType="DECIMAL"/>
        <id column="back_ratio" property="backRatio" jdbcType="FLOAT"/>
        <id column="red_ratio" property="redRatio" jdbcType="FLOAT"/>
        <id column="company_name" property="companyName" jdbcType="VARCHAR"/>
        <id column="company_lead" property="companyLead" jdbcType="VARCHAR"/>
        <id column="company_phone" property="companyPhone" jdbcType="VARCHAR"/>
        <id column="company_tel" property="companyTel" jdbcType="VARCHAR"/>
        <id column="company_address" property="companyAddress" jdbcType="VARCHAR"/>
        <id column="parent_id" property="parentId" jdbcType="VARCHAR"/>
        <id column="last_login_time" property="lastLoginTime" jdbcType="TIMESTAMP"/>
        <id column="last_login_ip" property="lastLoginIp" jdbcType="VARCHAR"/>
        <id column="status" property="status" jdbcType="VARCHAR"/>
        <id column="add_time" property="addTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <sql id="base_column_list">
        id,
        username,
        password,
        realname,
        phone,
        level,
        money,
        back_ratio,
        red_ratio,
        company_name,
        company_lead,
        company_phone,
        company_tel,
        company_address,
        parent_id,
        last_login_time,
        last_login_ip,
        status,
        add_time
    </sql>

    <select id="getAllAdmin" resultMap="baseResultMap">
        select
        <include refid="base_column_list"/>
        from t_admin t where 1=1
        <if test="adminListBean.conditions!=null and adminListBean.conditions!=''">
            and (username LIKE '%' #{adminListBean.conditions} '%' or realname LIKE '%' #{adminListBean.conditions} '%' or phone LIKE '%'
            #{adminListBean.conditions} '%')
        </if>
        <if test="adminListBean.addStartTime!=null and adminListBean.addStartTime!=''">
            AND add_time &gt;= CONCAT(#{adminListBean.addStartTime},' 00:00:00')
        </if>
        <if test="adminListBean.addEndTime!=null and adminListBean.addEndTime!=''">
            AND add_time &lt;= CONCAT(#{adminListBean.addEndTime},' 23:59:59')
        </if>
        <if test="showLevel != null and showLevel != ''">
            AND level = #{showLevel}
        </if>
        <if test="loginAdminId != null and loginAdminId != '' and showLevel == 2">
            AND parent_id = #{loginAdminId}
        </if>
        <if test="loginAdminId != null and loginAdminId != '' and showLevel == 3">
          AND EXISTS ( SELECT * FROM t_admin b WHERE 1 = 1 AND parent_id = #{loginAdminId} AND t.parent_id = b.id )
--           AND EXISTS ( SELECT id FROM t_admin WHERE 1 = 1 AND EXISTS ( SELECT id FROM t_admin WHERE parent_id = #{loginAdminId} ) )
        </if>
    </select>

    <select id="getCountAdmin" resultType="int">
        select count(1) FROM t_admin WHERE username = trim(#{username})
    </select>

    <select id="getCountAdminLogin" resultMap="baseResultMap">
        select * FROM t_admin WHERE username = trim(#{username}) AND password = trim(#{password})
    </select>

    <insert id="saveAdmin" parameterType="AdminBean"
            useGeneratedKeys="true" keyProperty="id">
        INSERT INTO `t_admin` ( `username`, `password`, `realname`, `phone`, `level`, `money`, `back_ratio`, `red_ratio`, `company_name`, `company_lead`, `company_phone`, `company_tel`, `company_address`, `parent_id`, `last_login_time`, `last_login_ip`, `status`, `add_time`) VALUES
	( TRIM(#{username}), #{password}, TRIM(#{realname}), TRIM(#{phone}), #{level}, #{money},TRIM(#{backRatio}), TRIM(#{redRatio}), #{companyName}, #{companyLead}, #{companyPhone}, #{companyTel}, #{companyAddress}, #{parentId}, #{lastLoginTime}, #{lastLoginIp}, #{status}, #{addTime})
    </insert>

    <update id="upateStatus" parameterType="string">
        UPDATE t_admin set status = #{status} where username = #{username}
    </update>

    <delete id="delete" parameterType="string">
        DELETE FROM t_admin WHERE username = #{username}
    </delete>

    <select id="getAdmin" parameterType="int" resultMap="baseResultMap">
        SELECT
        <include refid="base_column_list"/>
        FROM t_admin
        WHERE id = #{id}
    </select>

    <update id="updateAdmin">
        UPDATE t_admin SET
        <if test="username != null and username != ''">
            username = #{username, jdbcType=VARCHAR}
        </if>
        <if test="password != null and password != ''">
            ,password = #{password, jdbcType=VARCHAR}
        </if>
        <if test="realname != null and realname != ''">
            ,realname = #{realname, jdbcType=VARCHAR}
        </if>
        <if test="phone != null and phone != ''">
            ,phone = #{phone, jdbcType=VARCHAR}
        </if>
        <if test="lelevl != null and lelevl != ''">
            ,level = #{level, jdbcType=INTEGER}
        </if>
        <if test="money != null and money != ''">
            ,money = #{money, jdbcType=DOUBLE}
        </if>
        <if test="backRatio != null and backRatio != ''">
            ,back_ratio = #{backRatio, jdbcType=FLOAT}
        </if>
        <if test="redRatio != null and redRatio != ''">
            ,red_ratio = #{redRatio, jdbcType=FLOAT}
        </if>
        ,company_name = #{companyName, jdbcType=VARCHAR}
        ,company_lead = #{companyLead, jdbcType=VARCHAR}
        <if test="companyPhone != null and companyPhone != ''">
            ,company_phone = #{companyPhone, jdbcType=VARCHAR}
        </if>
        ,company_tel = #{companyTel, jdbcType=VARCHAR}
        ,company_address = #{companyAddress, jdbcType=VARCHAR}
        WHERE id = #{id}
    </update>

</mapper>